---
categories:
    - HTTP网络协议
tags:
    - HTTP网络协议
date: 2020-08-17
---





## HTTP报文

### HTTP报文是什么

HTTP 报文，又称 HTTP 消息，是服务器和客户端之间交换数据的方式。有两种类型的消息：请求，由客户端发送用来触妓一个服务器上的动作；响应，来自服务器的应答。

HTTP 消息由采用 ASCII 编码的多行文本构成。在 HTTP/1.1 及早期版本中，这些消息通过连接公开地发送。在 HTTP/2 中，为了优化和性能方面的改进，曾经可人工阅读的消息被分到多个 HTTP 帧中。



### HTTP请求报文

请求报文由以下元素组成：一个HTTP的method、要获取的资源的路径、HTTP协议版本号、为服务端表达其他信息的可选头部headers以及对于一些像POST这样的方法。

![](https://s1.ax1x.com/2020/08/17/dmr078.png)



### HTTP响应报文

响应报文由以下元素组成: HT TP协议版本号、一个状态码、一个状态信息、HT TP headers以及包含获取的资源body。

![](https://s1.ax1x.com/2020/08/17/dmrshQ.png)



## HTTP消息

### HTTP消息结构

1. start line：一行起始行用于描述要执行的请求，或者是对应的状态，成功或失败。这个起始行总是单行的。
2. HTTP headers：一个可选的 HTTP 头集合指明请求或描述消息正文。
3. empty line:- 个空行指示所有美于请求的元数据已经发送完毕。
4. body：一个可选的包含请求相美数据的正文（比如 HTML 表单内容）或者响应相美的文档。正文的大小有起始行的 HTTP 头来指定。

**起始行和 HTTP 消息中的 HTTP 头统称为 “请求头”，而其有效负载被称为 “消息正文” 结构是固定的。**



### 请求消息与响应消息

* HTTP请求消息：由客户端发送用来触发一个服务器上的动作
* HTTP响应消息：来自服务器的应答。

![](https://s1.ax1x.com/2020/08/17/dmrrtg.png)



## 请求消息

### 起始行

**起始行包含的三个元素**

* 请求方法：描述要执行的动作 例如：GET/POST
* 请求地址：通常是一个URL，或者是协议，端口和域名的绝对路径
* HTTP版本：定义了剩余报文的结构，作为对期望的响应版本的指示符



###  请求方法

* 最常用的请求方法是GET和POST
* 常见的请求方法至少有七种
* 请求方法不止七种



### 请求头

请求头允许客户端向服务器端传递附加信息。请求头由名称（不区分大小写）后跟一个冒号 “：”，冒号后跟具体的值（不带换行符）组成。

根据不同上下文，可将请求头分为：

1. 通用头：同时适用于请求和响应消息，但与最终消息主体中传输的数据无美的消息头
2. 请求头：包含更多有关要获取的资源或客户端本身信息的消息头。
3. 实体头：包含有关实体主体的更多信息，比如加主体长 Content- Length）度或其 MIME 类型。

![](https://s1.ax1x.com/2020/08/17/dmrDAS.png)



**请求头格式**

![](https://s1.ax1x.com/2020/08/17/dmr6pj.png)



### 请求主体

请求消息的最后一部分是请求主体。

- 不是所有的请求都需要请求主体：例如获取资源的请求 GET、HEAD、 DELEE 和 OPTIONS 通常它们不需要请求主体。
- 有些请求将数据妓送到服务器以便更新数据：常见的的情况是 POST 请求（包含 HTML 表单数据）。



请求主体大致可分为两类

1. 单一资原圭体：由一个单文件组成。该类型请求主体由两个 header 定义： Content-Type 和 Content-length
2. 多资源主体：由多部分请求主体组成，每一部分包含不同的信息位。通常是和 HTML 表单连系在一起



## 响应消息

### 状态行

HTTP 响应消息的起始行被称作状态行（statusline), 包含以下信息：

1. 协议版本：通常为 HTTP/1.1
2. 状态码：表明请求是成功或失败。常见的状态码是 200,404, 或 302.
3. 状态文本：一个简短的，纯粹的信息，通过状态码的文本描述，帮助人们理解该 HTTP 消息



### 响应头

响应头允许服务器端向客户端传递附加信息。响应头由名称（不区分大小写）后跟一个冒号 “：”，冒号后跟具体的值（不带换行符）组成

根据不同上下文，可将响应头分为

1. 通用头：同时适用于请求和响应消息，但与最终消息主体中传输的数据无关的消息头。
2. 响应头：包含有关响应的补充信息，如其位置或服务器本身（名称和版本等）的消息头。
3. 实体头：包含有关实体主体的更多信息，比如主体长（ Content- Length）度或其 MIME 类型。



![](https://s1.ax1x.com/2020/08/18/dKEZG9.png)

![](https://s1.ax1x.com/2020/08/18/dKEVPJ.png)



### 响应主体

响应消息的最后一部分是响应主体。不是所有的响应都需要响应主体：例如具有状态码（如 201 或 204) 的响应，通常不会有响应主体。
响应主体大致可分为两类

1. 单一资源主体：由已知长度的单个文件组成。该类型响应主体由两个 header 定义： Content Type 和 Content-length
2. 单一资原主仲：由未知长度的单个文件组成，通过将 Transfer- Encoding 设置为 chunked 来使用 chunks 编码
3. 多资源主体：由多部分响应主体组成，每部分包含不同的信息段。但这是比较少见的。



## MIME消息

MIME 类型全称为 Multipurpose Internet Mail Extensions，被译为多用途 Internet 邮件扩展类型，是一种标准化的方式来表示文档的性质和格式。

浏览器通常使用 MIME 类型（而不是文件扩展名）来确定如何处理文档；

|    类型     |         描述         |           实例           |
| :---------: | :------------------: | :----------------------: |
|    text     |  表明文件是普通文本  |   text/plain,text/html   |
|    image    |    表明是某种图像    |   image/png，image/gf    |
|    audio    |  表明是某种音频文件  |  audio/webm,audio/midi   |
|    video    |  表明是某种视频文件  |        video/webm        |
| application | 标明是某种二进制数据 | application/octet-stream |



## HTTP1.x的缺点

- 消息头不像消息主体一样会被压缩
- 两个报文之间的 header 通常非常相似，但它们仍然在连接中重复传输。
- 无法复用。当在同一个服务器打开几个连接时，TCP 热连接比冷连接更加有效。
  