---
categories:
    - HTTP网络协议
tags:
    - HTTP网络协议
date: 2020-08-18
---



## HTTP的缓存机制

### 缓存是什么

缓存是一种保存资源副本并在下次请求时直接使用该副本的技术。当 Web 缓存发现请求的资源已经被存储，它会拦截请求，返回该资源的拷贝，而不会去源服务器重新下载。

缓存需要合理配置，因为并不是所有资源都是永久不変的。重要的是对一个资源的缓存应截止到其下次发生改变（即不能缓存过期的资源）。

![](https://s1.ax1x.com/2020/08/18/dKaYKx.png)

![](https://s1.ax1x.com/2020/08/18/dKatr6.png)



### 缓存服务器端的数据的优点

1. 缓解服务器端的资源消耗和运行压力，提升服务器端的整体性能。
2. 减少服务器端资源加载的延迟，进而成少显示某个资源所用的时间
3. 减少对带宽造成的压力，避免网络阻塞问题的出现
4. Web 站点变得更具有响应性



### 缓存应用

常见的 HTTP 缓存只能存储 GET 响应

- 检索请求的成功响应：响应状态码为 200, 则表示为成功。包含例如 HTML 文档，图片，或者文件的响应。
- 不变的重定向：响应状态码为 301
- 错误响应：响应状态码为 404 的一个页面。
- 不完全的响应：响应状态码为 206, 只返回局部的信息。
- 除了 GET 请求外，如果匹配到作为ー个已被定义的 cache 键名的响应。



## 缓存机制

### 私有缓存

私有缓存只能用于单独用户。洳览器缓存拥有用户通过 HTTP 下载的所有文档。这些缓存为浏览过的文档提供向后 / 向前导航、保存网页、查看源码等功能，可以避免再次向服务器发起多余的请求。它同样可以提供缓存內容的离线览



**设置私有缓存的头部信息**

```
Cache-Control:private
```



### 共享缓存

共享缓存可以被多个用户使用。例如，ISP 或所在的公司可能会架设一个 web 代理来作为本地网络基础的一部分提供给用户。这样热门的资源就会被重复使用，减少网络拥堵与延迟



**设置共享缓存的头部信息**

```
Cache-Control:public
```



## 缓存控制

### Cache-control头

HTTP/1.1 定义的 Cache-Control 头用来区分对缓存机制的支持情况，请求头和响应头都支持这个属性。通过它提供的不同的值来定义存策略。



1. 禁止进行缓存

   ```
   Cache-Control: no-store
   Cache-Control: no-cache, no-store, must-revalidate
   ```

2. 强制确认缓存

   ```
   Cache-Control: no-cache
   ```

3. 缓存过期机制

   ```
   Cache-Control: max-age=(缓存过期时长)
   ```

4. 缓存验证确认

   ```
   Cache-Control: must-revalidate
   ```



### Pragma头

Pragma 头是 HTTP/1.0 标准中定义的一个 header 属性，请求中包含 Pragma 的效果跟在头信息中定义 “Cache-Control:no-cache” 相同。但是 HTTP 的响应头不支持这个属性，所以它不能拿来完全替代 HTTP/1.1 中定义的 Cache-Control 头。通常定义 Pragma 以向后兼容基于 HTTP/1.0 的客户。

```
Pragma: no-cache
```



### Expires 头

Expires 响应头包含日期 / 肘间，即在此时候之后，响应过期。

- 无效的日期，比如 0 代表着过去的日期，即该资源已经过期。
- 如果在 Cache-Control 响应头设置了 “max-age” 或者 “s-max-age” 指令，那么 Expires 头会被忽略

```
Expires: Wed,21 Oct 2015 07:28:00 GMT
```

